<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Offline Canteen Meal Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; }
    h2 { margin-top: 10px; }
    button { padding: 6px 10px; margin: 4px; }
    input, select { padding: 5px; margin: 4px; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .day { border: 1px solid #aaa; padding: 10px; text-align: center; cursor: pointer; }
    .dayMeal { background: lightgreen; }
    .nightMeal { background: lightblue; }
    .bothMeal { background: plum; }
    .holiday { background: lightcoral; }
    .controls button { display:block; width:100%; margin:2px 0; }
  </style>
</head>
<body><h2>Offline Canteen Meal Calculator</h2><input id="profileName" placeholder="Profile name (Hostel / Ram / Me)">
<button onclick="addProfile()">Add Profile</button>
<div id="profileList"></div>
<hr><select id="year" onchange="renderCalendar()"></select> <select id="month" onchange="renderCalendar()"></select> <button onclick="showYearSummary()">Show Year Summary</button>

<div id="activeProfile"></div>
<div id="yearSummary"></div><script>
let profiles = JSON.parse(localStorage.getItem('profiles')) || {};
let currentProfile = null;
const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
window.selectedType = null; // currently selected meal type

function saveData(){ localStorage.setItem('profiles', JSON.stringify(profiles)); }

function addProfile(){
  const name = profileName.value.trim();
  if(!name) return alert('Enter name');
  if(profiles[name]) return alert('Already exists');
  profiles[name] = { rate:0, data:{} };
  saveData(); profileName.value=''; renderProfiles();
}

function deleteProfile(name){
  if(confirm(`Are you sure you want to delete profile '${name}'?`)){
    delete profiles[name];
    if(currentProfile===name) currentProfile=null;
    saveData(); renderProfiles(); activeProfile.innerHTML=''; yearSummary.innerHTML='';
  }
}

function renameProfile(oldName){
  const newName = prompt('Enter new name:', oldName);
  if(!newName || profiles[newName]) return alert('Invalid or existing name');
  profiles[newName] = profiles[oldName];
  delete profiles[oldName];
  if(currentProfile === oldName) currentProfile = newName;
  saveData(); renderProfiles();
}

function renderProfiles(){
  profileList.innerHTML='<h3>Select Profile</h3>';
  for(let p in profiles){
    let div=document.createElement('div');
    let selectBtn=document.createElement('button'); selectBtn.innerText=p;
    selectBtn.onclick=()=>{currentProfile=p; renderCalendar();};
    let renameBtn=document.createElement('button'); renameBtn.innerText='Rename';
    renameBtn.onclick=()=>renameProfile(p);
    let deleteBtn=document.createElement('button'); deleteBtn.innerText='Delete';
    deleteBtn.onclick=()=>deleteProfile(p);
    div.appendChild(selectBtn);
    div.appendChild(renameBtn);
    div.appendChild(deleteBtn);
    profileList.appendChild(div);
  }
}

function initYearMonth(){
  for(let y=2020;y<=2035;y++) year.innerHTML+=`<option>${y}</option>`;
  months.forEach((m,i)=>month.innerHTML+=`<option value="${i}">${m}</option>`);
  const d=new Date(); year.value=d.getFullYear(); month.value=d.getMonth();
}

function renderCalendar(){
  if(!currentProfile) return;
  yearSummary.innerHTML='';
  const m=month.value, y=year.value;
  const key=`${y}-${m}`;
  const p=profiles[currentProfile];
  if(!p.data[key]) p.data[key]={ days:{} };

  activeProfile.innerHTML=`<h3>${currentProfile} (${months[m]} ${y})</h3>
  Meal Rate: <input type="number" value="${p.rate}" onchange="setRate(this.value)"><br><br>
  <div class="calendar" id="calendar"></div>
  <div class="controls">
    <button onclick="setSelected('dayMeal')">Day Meal</button>
    <button onclick="setSelected('nightMeal')">Night Meal</button>
    <button onclick="setSelected('bothMeal')">Both Meals</button>
    <button onclick="setSelected('holiday')">Holiday</button>
    <button onclick="setSelected(null)">Remove Selection</button>
    <button onclick="clearMonth()">Clear Month</button>
  </div>
  <h4 id="summary"></h4>`;

  const daysInMonth=new Date(y, Number(m)+1, 0).getDate();
  calendar.innerHTML='';
  for(let d=1; d<=daysInMonth; d++){
    let div=document.createElement('div'); div.className='day'; div.innerText=d;
    let status=p.data[key].days[d];
    div.classList.remove('dayMeal','nightMeal','bothMeal','holiday');
    if(status) div.classList.add(status);
    div.onclick=()=>applyMeal(d,key,div);
    calendar.appendChild(div);
  }
  updateSummary(key);
}

function setSelected(type){
  window.selectedType = type;
}

function applyMeal(d,key,div){
  // Clear existing styles
  div.classList.remove('dayMeal','nightMeal','bothMeal','holiday');

  if(window.selectedType === null){
    delete profiles[currentProfile].data[key].days[d];
  } else {
    profiles[currentProfile].data[key].days[d]=window.selectedType;
    div.classList.add(window.selectedType);
  }
  saveData(); updateSummary(key);
}

function clearMonth(){
  if(!currentProfile) return;
  if(!confirm('Are you sure you want to clear all data for this month?')) return;
  const m=month.value, y=year.value;
  const key=`${y}-${m}`;
  profiles[currentProfile].data[key]={ days:{} };
  saveData(); renderCalendar();
}

function setRate(v){ profiles[currentProfile].rate=Number(v); saveData(); renderCalendar(); }

function updateSummary(key){
  let meals=0; const days=profiles[currentProfile].data[key].days;
  for(let d in days){ if(days[d]=='bothMeal') meals+=2; else if(days[d]=='holiday') meals+=0; else meals+=1; }
  summary.innerText=`Monthly Meals: ${meals} | Monthly Amount: ₹${meals*profiles[currentProfile].rate}`;
}

function showYearSummary(){
  if(!currentProfile) return;
  let y=year.value; let totalMeals=0; let html=`<h3>Year Summary (${y})</h3>`;
  months.forEach((m,i)=>{
    const key=`${y}-${i}`;
    let meals=0;
    if(profiles[currentProfile].data[key]){
      const days=profiles[currentProfile].data[key].days;
      for(let d in days){ if(days[d]=='bothMeal') meals+=2; else if(days[d]=='holiday') meals+=0; else meals+=1; }
    }
    totalMeals+=meals;
    html+=`${m}: ${meals} meals<br>`;
  });
  html+=`<b>Total Year Meals:</b> ${totalMeals}<br>`;
  html+=`<b>Total Year Amount:</b> ₹${totalMeals*profiles[currentProfile].rate}`;
  yearSummary.innerHTML=html;
}

initYearMonth(); renderProfiles();
</script></body>
</html>  updateSummary(key);
}

function setSelected(type){ window.selectedType=type; }

function applyMeal(d,key,div){
  if(!window.selectedType) return alert('Select meal type first');
  profiles[currentProfile].data[key].days[d]=window.selectedType;
  saveData(); renderCalendar();
}

function setRate(v){ profiles[currentProfile].rate=Number(v); saveData(); renderCalendar(); }

function updateSummary(key){
  let meals=0; const days=profiles[currentProfile].data[key].days;
  for(let d in days){ if(days[d]=='bothMeal') meals+=2; else if(days[d]=='holiday') meals+=0; else meals+=1; }
  summary.innerText=`Monthly Meals: ${meals} | Monthly Amount: ₹${meals*profiles[currentProfile].rate}`;
}

function showYearSummary(){
  if(!currentProfile) return;
  let y=year.value; let totalMeals=0; let html=`<h3>Year Summary (${y})</h3>`;
  months.forEach((m,i)=>{
    const key=`${y}-${i}`;
    let meals=0;
    if(profiles[currentProfile].data[key]){
      const days=profiles[currentProfile].data[key].days;
      for(let d in days){ if(days[d]=='bothMeal') meals+=2; else if(days[d]=='holiday') meals+=0; else meals+=1; }
    }
    totalMeals+=meals;
    html+=`${m}: ${meals} meals<br>`;
  });
  html+=`<b>Total Year Meals:</b> ${totalMeals}<br>`;
  html+=`<b>Total Year Amount:</b> ₹${totalMeals*profiles[currentProfile].rate}`;
  yearSummary.innerHTML=html;
}

initYearMonth(); renderProfiles();
</script></body>
</html>
